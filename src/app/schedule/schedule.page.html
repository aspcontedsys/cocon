<ion-header>
  <ion-toolbar style="--background: #00000000; --ion-toolbar-background: #00000000; color: #fff;">
    <div class="toolbar-left">
      <ion-button fill="clear" (click)="goBack()" slot="start">
        <ion-icon name="chevron-back-outline"></ion-icon>
      </ion-button>
      <span class="page-title">Program Schedule</span>
    </div>
    <ion-buttons slot="end">
      <ion-button fill="clear"></ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="scientific-content" fullscreen>

  <!-- 📅 Date Tabs -->
  <div class="date-tabs">
    <div *ngFor="let day of eventDates"
         class="day-tab"
         [class.active]="day.active"
         (click)="selectDay(day)">
      <div class="label">{{ day.label }}</div>
      <div class="date">{{ day.formattedDate }}</div>
    </div>
  </div>

  <!-- 🏛 Hall Tabs -->
  <div class="hall-tabs">
    <div *ngFor="let hall of halls"
         class="hall-tab"
         [class.active]="hall.active"
         (click)="selectHall(hall)">
      {{ hall.name }}
    </div>
  </div>

  <!-- Timeline Header -->
  <div class="timeline-header">
    <div class="time-col">Time</div>
    <div class="program-col">Program</div>
  </div>

  <!-- Schedule Timeline -->
  <div class="schedule-container">
    <div class="time-block" *ngFor="let slot of filteredSchedule">
      
      <div class="time-col">
        <div class="main-time">
          {{ slot.start_time }}
          <span *ngIf="slot.end_time" class="time2">– {{ slot.end_time }}</span>
        </div>
      </div>

      <!-- Program -->
      <div class="programs-col">

        <!--  Break session -->
        <div *ngIf="slot.isBreak" class="break-session">
          <ion-item lines="none" class="break-item">
            <ion-label class="session-title">{{ slot.topic_name }}</ion-label>
          </ion-item>
        </div>

        <!--  Normal session -->
        <div *ngIf="!slot.isBreak">
          
          <!-- Accordion if roles exist -->
          <ng-container *ngIf="slot.roles && slot.roles.length > 0; else noRolesSession">
            <ion-accordion-group [value]="openedAccordion" (ionChange)="onAccordionChange($event)">
              <ion-accordion [value]="slot.start_time">
                <ion-item slot="header" lines="none">
                  <ion-label class="session-title">{{ slot.topic_name }}</ion-label>

                  <!-- ❤️ Favorite -->
                  <ion-button fill="clear" class="favorite-btn" *ngIf="isLoggedIn()" (click)="toggleFavorite(slot)">
                    <ion-icon [name]="isFavorite(slot) ? 'heart' : 'heart-outline'"
                              class="favorite-icon"></ion-icon>
                  </ion-button>
                </ion-item>
                
                <div class="session-body"
                     slot="content"
                     [ngClass]="{'active': openedAccordion === slot.start_time}">
                  <div *ngFor="let item of slot.roles" class="subsession">
                    <div class="sub-time">{{ item.role_name }}</div>
                    <div class="sub-details">
                      <div *ngFor="let role of item.participants" class="sub-speaker">
                        <span>{{ role.name }}</span>
                        <span>{{ role.email }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </ion-accordion>
            </ion-accordion-group>
          </ng-container>

         
          <ng-template #noRolesSession>
            <ion-item lines="none" class="simple-session">
              <ion-label class="session-title">{{ slot.topic_name }}</ion-label>
              <ion-button *ngIf="isLoggedIn()" fill="clear" class="favorite-btn" (click)="toggleFavorite(slot)">
                <ion-icon [name]="isFavorite(slot) ? 'heart' : 'heart-outline'"
                          class="favorite-icon"></ion-icon>
              </ion-button>
            </ion-item>
          </ng-template>

        </div>
      </div>
    </div>
  </div>
</ion-content>
